// Generated by CoffeeScript 1.6.3
(function() {
  $(document).ready(function() {
    $.fn.khausNumberFormat = function() {
      return this.each(function() {
        var number, replaceNumber;
        replaceNumber = function(number) {
          number = number.replace(/[^0-9]+/g, "");
          return number = number.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        };
        if ($(this).is(":input")) {
          number = $(this).val();
          return $(this).val(replaceNumber(number));
        } else {
          number = $(this).html();
          return $(this).html(replaceNumber(number));
        }
      });
    };
    $.fn.khausInputMoney = function() {
      return this.each(function() {
        $(this).khausInputNumber();
        $(this).khausNumberFormat();
        return $(this).on("keydown", function(t) {
          var p,
            _this = this;
          p = t.keyCode;
          if (p !== 37 && p !== 39) {
            return setTimeout(function() {
              return $(_this).khausNumberFormat();
            }, 1);
          }
        });
      });
    };
    $.fn.khausInputRut = function() {
      return this.each(function() {
        var number;
        $(this).khausInputNumber();
        $(this).attr("maxlength", 12);
        number = $(this).val();
        number = number.replace(/[^0-9kK]+/g, "");
        number = number.replace(/([0-9kK])$/, "-$1");
        number = number.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        $(this).val(number);
        return $(this).on("keydown", function(t) {
          var p,
            _this = this;
          p = t.keyCode;
          if (p !== 37 && p !== 39) {
            return setTimeout(function() {
              number = $(_this).val();
              number = number.replace(/[^0-9kK]+/g, "");
              number = number.replace(/([0-9kK])$/, "-$1");
              number = number.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
              return $(_this).val(number);
            }, 1);
          }
        });
      });
    };
    $.fn.khausInputNumber = function() {
      return this.each(function() {
        return $(this).on("keydown", function(t) {
          var p, rex;
          p = t.keyCode;
          if (p !== 8 && p !== 37 && p !== 39 && p !== 9) {
            rex = new RegExp("[0-9]");
            if (!String.fromCharCode(t.keyCode).match(rex) && !(p >= 96 && p <= 105)) {
              return t.preventDefault();
            }
          }
        });
      });
    };
    $.fn.khausForm = function(settings) {
      var message, o;
      o = $.extend({
        refresh: true,
        popoverContainer: false,
        async: true,
        send: function() {},
        response: function(message, formData) {}
      }, settings);
      if (localStorage.getItem("khausFormResponse")) {
        message = JSON.parse(localStorage.khausFormResponse);
        o.response(message);
        localStorage.removeItem("khausFormResponse");
      }
      return this.each(function() {
        var form;
        form = $(this);
        if (form.is("form")) {
          return form.on("submit", function(e) {
            var formData;
            o.send();
            e.preventDefault();
            form.find(".popover").remove();
            formData = form.serialize();
            return $.ajax(form.attr("action"), {
              dataType: "json",
              type: form.attr("method"),
              async: o.async,
              data: formData
            }).done(function(response) {
              var paramFormData;
              if (response.khausFormResponse != null) {
                if (response.khausFormResponse['form-errors'] != null) {
                  return $.each(response.khausFormResponse['form-errors'], function(key, value) {
                    return form.find(":input[name=" + key + "]").popover("destroy").popover({
                      trigger: "manual",
                      content: value,
                      container: o.popoverContainer
                    }).popover("show");
                  });
                } else if (response.khausFormResponse['form-location'] != null) {
                  return window.location = response.khausFormResponse['form-location'];
                } else {
                  if (o.refresh) {
                    localStorage.khausFormResponse = JSON.stringify(response.khausFormResponse);
                    return location.reload();
                  } else {
                    paramFormData = {};
                    $.each(form.serializeArray(), function(k, v) {
                      return paramFormData[v.name] = v.value;
                    });
                    return o.response(response.khausFormResponse, paramFormData);
                  }
                }
              }
            });
          });
        }
      });
    };
    $.bootstrapAlert = function(message, style) {
      var div;
      if (style == null) {
        style = "";
      }
      div = $("<div>", {
        "class": "alert alert-dismissable " + style
      }).html(message);
      $("<button>", {
        "class": "close",
        "data-dismiss": "alert",
        "aria-hidden": "true"
      }).html("&times;").prependTo(div);
      return div;
    };
  });

}).call(this);
